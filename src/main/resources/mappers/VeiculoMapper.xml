<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="VeiculoRepository">

	<resultMap id="resultVeiculoDto" type="com.arquitetura.DTO.VeiculoDto">
		<id property="id" column="id" />
		<result property="placa" column="placa" />
		<result property="renavam" column="renavam" />
		<result property="chassi" column="chassi" />
		
		<result property="modelo" column="modelo" />
		<result property="anoModelo" column="anoModelo" />
		<result property="anoFabricacao" column="anoFabricacao" />
		<result property="cor" column="cor" />
		
		<result property="observacao" column="observacao" />
		<result property="isVendido" column="isVendido" />
		
		<result property="valorEntrada" column="valorEntrada" />
		<result property="valorGasto" column="valorGasto" />
		
	</resultMap>

	<select id="findByVeiculos" resultMap="resultVeiculoDto">
		SELECT id, placa, renavam, chassi, modelo, ano_modelo as anoModelo, ano_fabricacao as anoFabricacao, cor, observacao, is_vendido as isVendido FROM veiculo
		where 1=1
		  <if test="placa != null">
		    AND placa like #{placa}
		  </if>
		  
		  <if test="renavam != null">
		    AND renavam like '%'#{renavam}'%'
		  </if>
		  
		  <if test="chassi != null">
		    AND chassi like #{chassi}
		  </if>
		  
		  <if test="modelo != null">
		    AND modelo like #{modelo}
		  </if>
		  
		  <if test="anoModelo != null">
		    AND ano_modelo like #{anoModelo}
		  </if>
		  
		  <if test="anoFabricacao != null">
		    AND ano_fabricacao like #{anoFabricacao}
		  </if>
		  
		  <if test="isVendido != null">
		    AND is_vendido = #{isVendido}
		  </if>
		  
		  
	</select>
	
	 <update id = "updateVeiculo" >
      UPDATE Veiculo SET is_vendido = true 
      WHERE id = #{id};
   </update>
   
	<select id="findByVeiculosLoja" resultMap="resultVeiculoDto">
		SELECT v.id, v.placa, v.renavam, v.chassi, v.modelo, v.ano_modelo as anoModelo, v.ano_fabricacao as anoFabricacao,
		 	   v.cor, v.observacao, v.is_vendido as isVendido, es.valor as valorEntrada,  sum(o.valor)  as valorGasto
		FROM veiculo v
			left join orcamento o on o.id_veiculo = v.id
			left join entrada_saida es on es.id_veiculo = v.id
		where 1=1 and is_vendido = false
		group by v.id
	</select>




</mapper>
